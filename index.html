<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MAC Garden ‚Äî Esquejes y Plantas Tropicales</title>

<style>
/* =========================
   VARIABLES
   ========================= */
:root{
  --blue:#0A4FFF;
  --green:#0AD18C;
  --dark:#033e1b;
  --bg:#ffffff;
  --muted:#f1fbf6;
}

/* =========================
   BASE
   ========================= */
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif;}
body{margin:0;background:var(--bg);color:var(--dark);}

/* =========================
   HEADER
   ========================= */
header{
  background:linear-gradient(90deg,var(--blue),var(--green));
  padding:16px;
  text-align:center;
}

header img{
  height:150px;
}

.site-title{
  margin:0;
  color:white;
  font-size:38px;
  font-weight:800;
}

/* =========================
   NAVBAR
   ========================= */
nav{
  background:var(--muted);
  padding:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:25px;
  font-weight:600;
}

.nav-left a{
  text-decoration:none;
  color:var(--dark);
  font-size:18px;
  margin-right:18px;
}

/* enlaces de auth (login / register) */
.nav-auth-link{
  margin-left:12px;
  text-decoration:none;
  font-size:14px;
  color:var(--dark);
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,0.08);
}

.nav-auth-primary{
  background:var(--blue);
  color:#fff;
  border:none;
}

/* men√∫ de usuario mini */
.user-menu{
  display:flex;
  align-items:center;
  gap:8px;
}

.user-avatar{
  width:32px;
  height:32px;
  border-radius:50%;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  color:var(--blue);
}

.user-text{
  display:flex;
  flex-direction:column;
  font-size:13px;
}

.user-name{
  font-weight:700;
}

.user-badge{
  font-size:11px;
  padding:2px 6px;
  border-radius:999px;
  background:#e9fff1;
  color:var(--dark);
}

.logout-btn{
  margin-left:8px;
  font-size:12px;
  border:none;
  background:#eee;
  padding:4px 8px;
  border-radius:6px;
  cursor:pointer;
}

/* =========================
   HERO
   ========================= */
.hero{
  text-align:center;
  padding:40px 20px;
}

.hero h1{
  font-size:36px;
  margin-bottom:8px;
}

/* =========================
   PRODUCTOS
   ========================= */
.container{
  max-width:1100px;
  margin:0 auto;
  padding:20px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}

.card{
  background:#ffffff;
  border:1px solid #dff2e7;
  border-radius:10px;
  padding:10px;
  text-align:center;
  transition:0.2s;
}

.card:hover{
  transform:scale(1.03);
}

.card img{
  width:100%;
  height:160px;
  object-fit:cover;
  border-radius:8px;
}

.card h3{margin:8px 0;font-size:18px;}
.card .price{color:var(--blue);font-weight:700;margin:6px 0;}

.btn{
  background:var(--blue);
  color:white;
  padding:8px 12px;
  border-radius:8px;
  text-decoration:none;
  display:inline-block;
  font-weight:700;
  margin-top:8px;
  cursor:pointer;
}

/* Selector de variante */
.variant{
  width:90%;
  padding:6px;
  margin-top:8px;
  border:1px solid #cceadc;
  border-radius:8px;
  font-size:15px;
}

/* =========================
   CARRITO PRO
   ========================= */
.cart-top-btn{
  position:fixed;
  right:20px;
  top:20px;
  background:var(--green);
  color:white;
  padding:12px 14px;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  z-index:900;
}

/* Animaci√≥n del icono carrito */
@keyframes pulse {
  0% { transform: scale(1); }
  70% { transform: scale(1.2); }
  100% { transform: scale(1); }
}
.pulse{
  animation:pulse 0.4s ease;
}

/* Panel del carrito */
#cart-panel{
  position:fixed;
  top:0;
  right:-420px;
  width:380px;
  height:100%;
  background:#ffffff;
  backdrop-filter:blur(4px);
  box-shadow:-4px 0 18px rgba(0,0,0,0.25);
  padding:25px;
  border-radius:12px 0 0 12px;
  transition:right .35s ease;
  z-index:999;
  overflow-y:auto;
}

#cart-panel.open{
  right:0;
}

/* Items del carrito */
.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#f7fffa;
  padding:12px;
  border-radius:12px;
  margin-bottom:14px;
  transition:transform .25s ease, opacity .25s ease;
}

.cart-item:hover{
  transform:scale(1.02);
}

/* Controles de cantidad */
.qty-controls{
  display:flex;
  flex-direction:column;
  gap:4px;
}

/* ==== BOTONES MINIMALISTAS DEL CARRITO ==== */
.qty-controls button {
  background: transparent !important;
  border: 2px solid #000 !important;
  color: #000 !important;
  font-size: 18px !important;
  font-weight: 700 !important;
  border-radius: 6px !important;
  padding: 4px 10px !important;
  cursor: pointer;
  transition: 0.25s ease;
}

.qty-controls button:hover {
  background: #000 !important;
  color: #fff !important;
}

/* Bot√≥n de eliminar (‚ùå) */
.qty-controls button:last-child {
  border-color: #b30000 !important;
  color: #b30000 !important;
}

.qty-controls button:last-child:hover {
  background: #b30000 !important;
  color: white !important;
}

/* Total general */
#cart-total{
  background:#e9fff1;
  font-size:20px;
  padding:16px;
  border-radius:10px;
  margin-top:20px;
  font-weight:800;
  color:var(--dark);
  text-align:center;
}

/* Bot√≥n WhatsApp en carrito */
.cart-btn{
  background:var(--green);
  padding:13px;
  border-radius:10px;
  color:white;
  font-size:17px;
  text-align:center;
  display:block;
  margin-top:18px;
  font-weight:800;
  text-decoration:none;
  transition:.25s;
}

.cart-btn:hover{
  background:#09b677;
}

/* Animaci√≥n fade-in para items nuevos */
@keyframes fadein {
  from { opacity:0; transform:translateX(20px); }
  to   { opacity:1; transform:translateX(0); }
}
.fade-in{
  animation:fadein .35s ease;
}

/* =========================
   WHATSAPP FLOAT
   ========================= */
.whatsapp-float{
  position:fixed;
  right:18px;
  bottom:18px;
  z-index:900;
}

.whatsapp-float a{
  display:flex;
  gap:10px;
  align-items:center;
  padding:12px 14px;
  background:linear-gradient(90deg,var(--green),#06b070);
  color:white;
  border-radius:999px;
  text-decoration:none;
  font-weight:700;
}

/* =========================
   FOOTER
   ========================= */
footer{
  margin-top:40px;
  background:var(--blue);
  color:white;
  text-align:center;
  padding:14px;
}
</style>
</head>
<body>

<!-- =========================
     HEADER Y NAV
     ========================= -->
<header>
  <img src="img/logo.svg" alt="MAC Garden Logo">
  <h1 class="site-title">MAC Garden</h1>
</header>

<nav>
  <div class="nav-left">
    <a href="index.html">Inicio</a>
    <a href="services.html">Servicios</a>
    <a href="about.html">Nosotros</a>
    <a href="#productos">Productos</a>
    <a href="contact.html">Contacto</a>
    <a href="register.html">Registrarse</a>
  </div>
  <div id="nav-user"></div>
</nav>

<!-- BOT√ìN FLOTANTE CARRITO -->
<div class="cart-top-btn" onclick="toggleCart()">üõí Carrito (<span id="cart-count">0</span>)</div>

<!-- PANEL DEL CARRITO -->
<div id="cart-panel">
  <button onclick="toggleCart()" 
          style="position:absolute;top:10px;right:10px;
                 background:none;border:none;font-size:24px;cursor:pointer;">
    ‚úñ
  </button>

  <h2 style="margin-top:38px">Tu Carrito</h2>

  <div id="cart-items"></div>

  <!-- TOTAL GENERAL -->
  <div id="cart-total">Total general: RD$0</div>

  <a id="cart-whatsapp" class="cart-btn" href="#" target="_blank">
    Enviar por WhatsApp
  </a>
</div>

<!-- HERO -->
<section id="inicio" class="hero">
  <h1>Bienvenido a MAC Garden</h1>
  <p>Esquejes saludables, producci√≥n sostenible y venta directa por WhatsApp.</p>
</section>

<!-- PRODUCTOS -->
<div id="productos" class="container">
  <h2 id="catalogo">Cat√°logo ‚Äî Esquejes Disponibles</h2>
  <div class="grid" id="product-grid"></div>
</div>

<footer>MAC Garden ¬© 2025 ‚Äî Rep√∫blica Dominicana</footer>

<div class="whatsapp-float">
  <a href="https://wa.me/18496079790" target="_blank">üí¨ WhatsApp</a>
</div>

<!-- auth (manejo de usuario / login / register) -->
<script src="auth.js"></script>

<!-- =========================
     JAVASCRIPT - PRODUCTOS + CARRITO
     ========================= -->
<script>
// Usamos la API_BASE que define auth.js si existe
const API_URL = (typeof API_BASE !== 'undefined')
  ? API_BASE
  : 'http://localhost:3000/api';

let products = [];
let currentUser = null;
let esMayorista = false;

// CARRITO (con localStorage)
let cart = JSON.parse(localStorage.getItem("mac_cart") || "[]");

function saveCart(){
  localStorage.setItem("mac_cart", JSON.stringify(cart));
}

// Cargar productos y variantes desde el backend
async function loadProducts() {
  try {
    const res = await fetch(`${API_URL}/productos`);
    const productosBase = await res.json();

    const productosFinal = [];

    for (const p of productosBase) {
      const vr = await fetch(`${API_URL}/productos/${p.id}/variantes`);
      const variantes = await vr.json();

      const base = Number(p.precio_base || 0);

      const opciones = variantes.length > 0
        ? variantes.map(v => {
            const adicional = Number(v.precio || 0); // 'precio' viene del alias en el server
            return {
              nombre: v.nombre_variante,
              precio_final: base + adicional
            };
          })
        : [{
            nombre: "Est√°ndar",
            precio_final: base
          }];

      productosFinal.push({
        id: p.id,
        name: p.nombre,
        img: p.imagen_principal || "img/placeholder.jpg",
        opciones
      });
    }

    products = productosFinal;
    renderProducts();

  } catch (e) {
    console.error("Error cargando productos:", e);
  }
}

// RENDERIZAR PRODUCTOS
function renderProducts(){
  const grid = document.getElementById('product-grid');
  grid.innerHTML = '';

  products.forEach(p => {
    const variantesHTML = p.opciones
      .map(v => `
        <option value="${v.nombre}" data-precio="${v.precio_final}">
          ${v.nombre} ‚Äî RD$${v.precio_final}
        </option>
      `)
      .join("");

    const div = document.createElement('div');
    div.className = 'card';

    const precioInicial = p.opciones[0].precio_final;

    div.innerHTML = `
      <img src="${p.img}">
      <h3>${p.name}</h3>

      <select id="opt-${p.id}" class="variant" onchange="updatePrice(${p.id})">
        ${variantesHTML}
      </select>

      <p class="price" id="price-${p.id}">RD$${precioInicial}</p>

      <button class="btn" onclick="addToCart(${p.id})">Agregar al carrito</button>
    `;

    grid.appendChild(div);
  });
}

// Actualizar precio cuando cambia la variante
function updatePrice(id){
  const select = document.getElementById(`opt-${id}`);
  if (!select) return;
  const precio = Number(select.options[select.selectedIndex].dataset.precio || 0);
  document.getElementById(`price-${id}`).innerText = "RD$" + precio;
}

// AGREGAR AL CARRITO
function addToCart(id){
  const prod = products.find(p => p.id === id);
  if (!prod) return;

  const select = document.getElementById(`opt-${id}`);
  const varianteNombre = select ? select.value : "Est√°ndar";
  const precioVariante = select
    ? Number(select.options[select.selectedIndex].dataset.precio || 0)
    : prod.opciones[0].precio_final;

  const item = cart.find(i => i.id === id && i.variante === varianteNombre);

  if(item){
    item.cantidad++;
  } else {
    cart.push({
      id: id,
      name: prod.name,
      variante: varianteNombre,
      precio: precioVariante, // n√∫mero
      cantidad: 1
    });
  }

  updateCartCount();
  renderCart();
  saveCart();
  animateCartIcon();
}

// RENDERIZAR CARRITO
function renderCart(){
  const box = document.getElementById('cart-items');
  const totalBox = document.getElementById('cart-total');

  box.innerHTML = '';
  let total = 0;

  cart.forEach((item,i)=>{
    const price = Number(item.precio || 0);
    const subtotal = item.cantidad * price;
    total += subtotal;

    const div = document.createElement('div');
    div.className = 'cart-item fade-in';

    div.innerHTML = `
      <span>
        <strong>${item.name}</strong><br>
        <small>Variante: ${item.variante}</small><br>
        <small>Precio: RD$${price}</small><br>
        <small>Cantidad: ${item.cantidad}</small><br>
        <strong>Subtotal: RD$${subtotal}</strong>
      </span>
      <div class="qty-controls">
        <button onclick="changeQty(${i},-1)">‚ûñ</button>
        <button onclick="changeQty(${i},1)">‚ûï</button>
        <button onclick="removeItem(${i})">‚ùå</button>
      </div>
    `;
    box.appendChild(div);
  });

  totalBox.innerHTML = `Total general: RD$${total}`;
  updateWhatsApp();
}

// CAMBIAR CANTIDAD
function changeQty(i, amount){
  cart[i].cantidad += amount;
  if(cart[i].cantidad <= 0){
    cart.splice(i,1);
  }
  updateCartCount();
  renderCart();
  saveCart();
}

// ELIMINAR ITEM
function removeItem(i){
  cart.splice(i,1);
  updateCartCount();
  renderCart();
  saveCart();
}

// CONTADOR DEL ICONO
function updateCartCount(){
  const total = cart.reduce((sum,item)=>sum+item.cantidad,0);
  document.getElementById('cart-count').innerText = total;
}

// WHATSAPP
function updateWhatsApp(){
  const link = document.getElementById("cart-whatsapp");
  if(!cart.length){
    link.href = "https://wa.me/18496079790";
    return;
  }

  const msg = cart.map(i =>
    `‚Ä¢ ${i.name} (${i.variante}) ‚Äî ${i.cantidad} unidad(es) - RD$${i.precio}`
  ).join("%0A");

  const total = cart.reduce((sum,i)=>
    sum + (Number(i.precio || 0) * i.cantidad)
  ,0);

  const url =
    `https://wa.me/18496079790?text=` +
    encodeURIComponent(
      `Hola, quiero ordenar:\n\n${msg}\n\nTotal: RD$${total}`
    );

  link.href = url;
}

// MOSTRAR / OCULTAR CARRITO
function toggleCart(){
  document.getElementById("cart-panel").classList.toggle("open");
}

// Animaci√≥n icono carrito
function animateCartIcon(){
  const icon = document.querySelector(".cart-top-btn");
  icon.classList.add("pulse");
  setTimeout(()=>icon.classList.remove("pulse"),300);
}

// INICIO
window.onload = ()=>{
  if (typeof getCurrentUser === 'function') {
    currentUser = getCurrentUser();
    esMayorista = !!(currentUser && currentUser.tipo_cliente === 'mayorista');
  }

  loadProducts();
  updateCartCount();
  renderCart();
};
</script>


</body>
</html>


